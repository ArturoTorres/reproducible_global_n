{
  "hash": "eaef90832e881caba7de1d0c527b5bc1",
  "result": {
    "markdown": "---\ntitle: \"Reproducible Global N\"\nsubtitle: \"Reproducible Spatial Analysis for Charting Nitrogen Dynamics in Global Wheat Production\"\ndate: 2023-10-17\ndate-format: full\nauthor:\n  - Arturo Torres\ninstitute:\n  - \"\"\nformat: \n  beamer:\n    incremental: true \n    cite-method: natbib\n  html: default\nkeep-tex: true\naspectratio: 169\nfig-height: 5.3\t\nmonofont: 'Menlo'\nmonofontoptions: \n  - Scale=0.35\nbibliography: global_n.bib\n---\n\n\n\n\n## Goal\n\n-   Following the indications, the goal of this reproducible code is to (IIASA-BNR, 2023, assignment):\n\n    -   \"Combine various datasets to generate indictors of nitrogen loss to the environment associated with wheat production at various spatial scales\"\n\n    -   \"Provide graphical representations and conduct simple comparisons across a few countries\"\n\n    -   \"Provide a reproducible code associated to these tasks.\"\n\n\n## Task 1\n\n- Using SPAM raster data [@wood-sichra_spatial_2016], a new raster at the same resolution, containing wheat production volume (in million tons Mt) is produced. \n\n- Global scale in a raster format (5 arcminute spatial resolution) estimates of yield (r_y) in Kg/Ha, physical area (r_a) in Ha and harvested area (r_h) in Ha for the year 2005 are available.\n\n\n\n\\linespread{0.5}\n::: {.cell}\n\n:::\n\n\\linespread{2}\n\n## Reading SPAM data\n\n\n\\linespread{0.5}\n::: {.cell}\n\n```{.r .cell-code}\nspam_data = list(\"yield\" = rast(\"data/SPAM_2005_v3.2/SPAM2005V3r2_global_Y_TA_WHEA_A.tif\"),\n                 \"harvested_area\" = rast(\"data/SPAM_2005_v3.2/SPAM2005V3r2_global_H_TA_WHEA_A.tif\"),\n                 \"physical_area\" = rast(\"data/SPAM_2005_v3.2/SPAM2005V3r2_global_A_TA_WHEA_A.tif\"))\n```\n:::\n\n\\linespread{2}\n\n\\linespread{0.5}\n::: {.cell}\n\n```{.r .cell-code}\nstr(spam_data)   \n```\n\n::: {.cell-output .cell-output-stdout}\n```\nList of 3\n $ yield         :S4 class 'SpatRaster' [package \"terra\"]\n $ harvested_area:S4 class 'SpatRaster' [package \"terra\"]\n $ physical_area :S4 class 'SpatRaster' [package \"terra\"]\n```\n:::\n\n```{.r .cell-code}\nspam_data[['yield']]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nclass       : SpatRaster \ndimensions  : 1853, 4320, 1  (nrow, ncol, nlyr)\nresolution  : 0.08333333, 0.08333333  (x, y)\nextent      : -180, 180, -64.41667, 90  (xmin, xmax, ymin, ymax)\ncoord. ref. : lon/lat WGS 84 (EPSG:4326) \nsource      : SPAM2005V3r2_global_Y_TA_WHEA_A.tif \nname        : SPAM2005V3r2_global_Y_TA_WHEA_A \nmin value   :                               0 \nmax value   :                           19429 \n```\n:::\n:::\n\n\\linespread{2}\n\n\n\n## Calculate Wheat Production\n- Calculate wheat production by multiplying the raster layers for yield (in Kg/Ha) and harvested area (in Ha) using the * operator: \n\n  - wheat_production = spam_data[[\"yield\"]] * spam_data[[\"harvested_area\"]]\n\n- Convert Units: The resulting values are in Kg, so it is needed to convert them to million tons (Mt). Assuming 1 ton is equal to 1,000 Kg, it is possible to use the following:\n\n  - wheat_production_Mt = wheat_production / (1e3 * 1e6)\n\n## Calculate Wheat Production\n\n- A global map is created and the raster is exported in a geotif format:\n\n::: columns\n::: {.column width=\"80%\"}\n\n\\linespread{0.5}\n::: {.cell}\n\n```{.r .cell-code}\nwheat_production = spam_data[[\"yield\"]] * spam_data[[\"harvested_area\"]]\nwheat_production_Mt <- wheat_production / (1e9)\n```\n:::\n\n\\linespread{2}\n\n\\linespread{0.5}\n::: {.cell}\n\n```{.r .cell-code}\nplot(wheat_production_Mt, col = terrain.colors(10, rev=TRUE))\n```\n\n::: {.cell-output-display}\n![](global_n_files/figure-beamer/unnamed-chunk-6-1.pdf)\n:::\n:::\n\n\\linespread{2}\n\n\\linespread{0.5}\n::: {.cell}\n\n```{.r .cell-code}\nwriteRaster(wheat_production_Mt, filename = \"./output/wheat_production_Mt.tif\", \n            overwrite=TRUE, gdal = c(\"COMPRESS=DEFLATE\", \"TFW=YES\"))\n```\n:::\n\n\\linespread{2}\n\n:::\n:::\n\n## Task 2\n\n- Using the newly created raster and the GAUL shapefile of administrative borders, the  production is aggregated to country level and exported to a csv file.\n\n\n## Assumptions made\n- The three input maps from the SPAM model for the year 2005 are global scale in raster format (5 arcminute spatial resolution):\n  - Estimates of yield (r_y) in Kg/Ha, \n  - Physical area (r_a) in Ha, \n  - Harvested area (r_h) in Ha.\n\n\n## Issues\n\n## References\n\n::: {#refs}\n:::\n\n\n\\linespread{0.5}\n::: {.cell}\n\n:::\n\n\\linespread{2}",
    "supporting": [
      "global_n_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}